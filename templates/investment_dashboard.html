<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI投資管理ダッシュボード | 競艇AI予想システム</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .investment-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        .performance-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 15px;
        }
        .risk-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-radius: 15px;
        }
        .strategy-card {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            border-radius: 15px;
        }
        .investment-opportunity {
            border-left: 4px solid #28a745;
            background-color: #f8f9fa;
        }
        .investment-risk {
            border-left: 4px solid #dc3545;
            background-color: #fff5f5;
        }
        .live-indicator {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .roi-positive { color: #28a745; font-weight: bold; }
        .roi-negative { color: #dc3545; font-weight: bold; }
        .confidence-bar {
            height: 8px;
            background: linear-gradient(90deg, #dc3545 0%, #ffc107 50%, #28a745 100%);
            border-radius: 4px;
        }
        .ai-enhanced {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            border-radius: 20px;
            padding: 2px 8px;
            font-size: 0.8em;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-robot me-2"></i>競艇AI投資システム
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/"><i class="fas fa-home"></i> メイン</a>
                <a class="nav-link" href="/predict"><i class="fas fa-crystal-ball"></i> 予想</a>
                <a class="nav-link" href="/realtime"><i class="fas fa-satellite-dish"></i> リアルタイム</a>
                <a class="nav-link active" href="/investment"><i class="fas fa-coins"></i> AI投資</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- ステータスヘッダー -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card investment-card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-wallet fa-3x mb-3"></i>
                        <h5>利用可能資金</h5>
                        <h3 id="available-funds">¥10,000</h3>
                        <small>AI投資システム管理下</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card performance-card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-chart-line fa-3x mb-3"></i>
                        <h5>ROI</h5>
                        <h3 id="roi-percentage" class="roi-positive">+5.2%</h3>
                        <small>AI強化投資収益率</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card risk-card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-shield-alt fa-3x mb-3"></i>
                        <h5>的中率</h5>
                        <h3 id="win-rate">67.5%</h3>
                        <small>AI予想的中率</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card strategy-card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-chess-queen fa-3x mb-3"></i>
                        <h5>投資戦略</h5>
                        <h3 id="current-strategy">バランス</h3>
                        <small>AI最適化戦略</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- 投資機会分析 -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-search-dollar me-2"></i>AI投資機会分析
                            <span class="live-indicator badge bg-success ms-2">LIVE</span>
                        </h5>
                        <div>
                            <button class="btn btn-outline-primary btn-sm" onclick="refreshOpportunities()">
                                <i class="fas fa-sync-alt"></i> 更新
                            </button>
                            <button class="btn btn-success btn-sm" onclick="runInvestmentSession()">
                                <i class="fas fa-play"></i> セッション実行
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="investment-opportunities">
                            <!-- 投資機会リストが動的に挿入される -->
                            <div class="investment-opportunity p-3 rounded mb-3">
                                <div class="row align-items-center">
                                    <div class="col-md-2">
                                        <strong>平和島 1R</strong>
                                        <br><small class="text-muted">14:30</small>
                                        <br><span class="ai-enhanced">AI強化</span>
                                    </div>
                                    <div class="col-md-2">
                                        <span class="badge bg-primary">単勝</span>
                                        <br><strong>3号艇</strong>
                                    </div>
                                    <div class="col-md-2">
                                        <small>AI信頼度</small>
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar bg-success" style="width: 78.5%"></div>
                                        </div>
                                        <strong>78.5%</strong>
                                    </div>
                                    <div class="col-md-2">
                                        <small>最適賭け金</small>
                                        <br><strong>¥150</strong>
                                        <br><small class="text-muted">ケリー基準</small>
                                    </div>
                                    <div class="col-md-2">
                                        <small>期待オッズ</small>
                                        <br><strong>3.2倍</strong>
                                        <br><small class="text-success">+330円</small>
                                    </div>
                                    <div class="col-md-2">
                                        <button class="btn btn-success btn-sm w-100" onclick="executeInvestment(4, 1)">
                                            <i class="fas fa-play"></i> 投資実行
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="investment-risk p-3 rounded mb-3">
                                <div class="row align-items-center">
                                    <div class="col-md-2">
                                        <strong>住之江 2R</strong>
                                        <br><small class="text-muted">14:55</small>
                                    </div>
                                    <div class="col-md-2">
                                        <span class="badge bg-info">複勝</span>
                                        <br><strong>1号艇</strong>
                                    </div>
                                    <div class="col-md-2">
                                        <small>AI信頼度</small>
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar bg-warning" style="width: 52.1%"></div>
                                        </div>
                                        <strong>52.1%</strong>
                                    </div>
                                    <div class="col-md-2">
                                        <small>推奨賭け金</small>
                                        <br><span class="text-danger">見送り</span>
                                        <br><small class="text-muted">閾値未達</small>
                                    </div>
                                    <div class="col-md-2">
                                        <small>期待オッズ</small>
                                        <br><strong>1.8倍</strong>
                                        <br><small class="text-warning">低収益</small>
                                    </div>
                                    <div class="col-md-2">
                                        <button class="btn btn-outline-secondary btn-sm w-100" disabled>
                                            <i class="fas fa-ban"></i> 条件未達
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-cog me-2"></i>AI投資設定</h5>
                    </div>
                    <div class="card-body">
                        <form>
                            <div class="mb-3">
                                <label class="form-label">投資戦略</label>
                                <select class="form-select" id="investment-strategy">
                                    <option value="conservative">保守的戦略 (75%+ 信頼度)</option>
                                    <option value="balanced" selected>バランス戦略 (65%+ 信頼度)</option>
                                    <option value="aggressive">積極的戦略 (55%+ 信頼度)</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">最大賭け金</label>
                                <input type="number" class="form-control" value="500" min="100" max="2000">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">AI信頼度閾値</label>
                                <input type="range" class="form-range" min="50" max="90" value="65" id="confidence-threshold">
                                <small id="confidence-value">65%</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">日次損失限度額</label>
                                <input type="number" class="form-control" value="1000" min="500" max="5000">
                            </div>
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="auto-investment">
                                    <label class="form-check-label">AI自動投資</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="form-check form-switch" checked>
                                    <input class="form-check-input" type="checkbox" id="simulation-mode" checked>
                                    <label class="form-check-label">シミュレーションモード</label>
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary w-100">設定保存</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI学習と投資履歴 -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-brain me-2"></i>AI学習状況</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6">
                                <div class="text-center">
                                    <i class="fas fa-database fa-2x text-primary mb-2"></i>
                                    <h6>学習サンプル数</h6>
                                    <h4 id="learning-samples">1,247</h4>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center">
                                    <i class="fas fa-chart-line fa-2x text-success mb-2"></i>
                                    <h6>AI予想精度</h6>
                                    <h4 id="ai-accuracy">82.1%</h4>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-6">
                                <div class="text-center">
                                    <i class="fas fa-sync-alt fa-2x text-info mb-2"></i>
                                    <h6>最終学習時刻</h6>
                                    <h6 id="last-learning">14:30</h6>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center">
                                    <i class="fas fa-rocket fa-2x text-warning mb-2"></i>
                                    <h6>AI加速効果</h6>
                                    <h4 id="ai-boost">+12.8%</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-history me-2"></i>投資履歴（直近10件）</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm" id="investment-history-table">
                                <thead>
                                    <tr>
                                        <th>時間</th>
                                        <th>レース</th>
                                        <th>賭け方</th>
                                        <th>金額</th>
                                        <th>結果</th>
                                        <th>収益</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>14:35</td>
                                        <td>平和島1R</td>
                                        <td>単勝 3号艇</td>
                                        <td>¥150</td>
                                        <td><span class="badge bg-success">的中</span></td>
                                        <td class="roi-positive">+¥330</td>
                                    </tr>
                                    <tr>
                                        <td>14:10</td>
                                        <td>桐生12R</td>
                                        <td>複勝 1号艇</td>
                                        <td>¥200</td>
                                        <td><span class="badge bg-danger">外れ</span></td>
                                        <td class="roi-negative">-¥200</td>
                                    </tr>
                                    <tr>
                                        <td>13:45</td>
                                        <td>住之江11R</td>
                                        <td>単勝 2号艇</td>
                                        <td>¥100</td>
                                        <td><span class="badge bg-success">的中</span></td>
                                        <td class="roi-positive">+¥180</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- リスク管理とパフォーマンス分析 -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-shield-alt me-2"></i>リスク管理状況</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6">
                                <div class="text-center">
                                    <h6>本日損失限度額</h6>
                                    <div class="progress mb-2">
                                        <div class="progress-bar bg-warning" style="width: 25%"></div>
                                    </div>
                                    <small>¥250 / ¥1,000</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center">
                                    <h6>連続損失回数</h6>
                                    <h4 class="text-info">1回</h4>
                                    <small>限度: 3回</small>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-6">
                                <strong>リスクレベル</strong>
                                <br><span class="badge bg-success">低リスク</span>
                            </div>
                            <div class="col-6">
                                <strong>投資判定</strong>
                                <br><span class="badge bg-primary">継続可能</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>パフォーマンス分析</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6">
                                <div class="text-center">
                                    <h6>シャープレシオ</h6>
                                    <h4 class="text-success">1.23</h4>
                                    <small>優秀なリスク調整後収益</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center">
                                    <h6>最大ドローダウン</h6>
                                    <h4 class="text-warning">-8.5%</h4>
                                    <small>許容範囲内</small>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-6">
                                <strong>勝率トレンド</strong>
                                <br><span class="badge bg-success">上昇傾向</span>
                            </div>
                            <div class="col-6">
                                <strong>AI学習効果</strong>
                                <br><span class="badge bg-primary">有効</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 投資セッション実行結果 -->
        <div class="row mb-4" id="session-results" style="display: none;">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-play-circle me-2"></i>投資セッション結果
                            <span class="badge bg-info ms-2">SIMULATION</span>
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="session-summary" class="row mb-3">
                            <!-- セッション結果が動的に挿入される -->
                        </div>
                        <div id="session-details">
                            <!-- 詳細結果が動的に挿入される -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 投資戦略最適化推奨 -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-lightbulb me-2"></i>AI投資戦略最適化推奨
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="alert alert-info">
                                    <strong><i class="fas fa-info-circle me-2"></i>リスク管理</strong>
                                    <ul class="mb-0 mt-2">
                                        <li>現在の損失限度額は適切です</li>
                                        <li>連続損失回数は許容範囲内</li>
                                        <li>AI信頼度閾値を65%に維持推奨</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="alert alert-success">
                                    <strong><i class="fas fa-chart-line me-2"></i>戦略最適化</strong>
                                    <ul class="mb-0 mt-2">
                                        <li>平和島会場でのパフォーマンス良好</li>
                                        <li>単勝投資の効率が高い</li>
                                        <li>AI学習効果が明確に現れています</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="alert alert-warning">
                                    <strong><i class="fas fa-clock me-2"></i>タイミング</strong>
                                    <ul class="mb-0 mt-2">
                                        <li>14:00-15:00の時間帯が有効</li>
                                        <li>1R-3Rでの的中率が高い</li>
                                        <li>天候安定時の投資を推奨</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        class AIInvestmentDashboard {
            constructor() {
                this.isAutoInvestmentEnabled = false;
                this.simulationMode = true;
                this.investmentSystem = null;
                this.investmentData = {
                    availableFunds: 10000,
                    roiPercentage: 5.2,
                    winRate: 67.5,
                    currentStrategy: 'balanced',
                    aiAccuracy: 82.1,
                    learningSamples: 1247,
                    aiBoost: 12.8
                };
                
                this.init();
            }
            
            init() {
                this.updateDashboard();
                this.setupEventListeners();
                this.startLiveUpdates();
                this.initInvestmentSystem();
            }
            
            initInvestmentSystem() {
                // AI投資システム初期化（模擬）
                this.investmentSystem = {
                    analyzeOpportunity: this.mockAnalyzeOpportunity.bind(this),
                    executeInvestment: this.mockExecuteInvestment.bind(this),
                    runSession: this.mockRunSession.bind(this)
                };
            }
            
            setupEventListeners() {
                // 投資戦略変更
                document.getElementById('investment-strategy').addEventListener('change', (e) => {
                    this.changeStrategy(e.target.value);
                });
                
                // 信頼度閾値スライダー
                const confidenceSlider = document.getElementById('confidence-threshold');
                confidenceSlider.addEventListener('input', (e) => {
                    document.getElementById('confidence-value').textContent = e.target.value + '%';
                });
                
                // AI自動投資トグル
                document.getElementById('auto-investment').addEventListener('change', (e) => {
                    this.isAutoInvestmentEnabled = e.target.checked;
                    if (this.isAutoInvestmentEnabled) {
                        this.startAutoInvestment();
                    } else {
                        this.stopAutoInvestment();
                    }
                });
                
                // シミュレーションモード
                document.getElementById('simulation-mode').addEventListener('change', (e) => {
                    this.simulationMode = e.target.checked;
                });
            }
            
            updateDashboard() {
                // 基本情報更新
                document.getElementById('available-funds').textContent = '¥' + this.investmentData.availableFunds.toLocaleString();
                
                const roiElement = document.getElementById('roi-percentage');
                roiElement.textContent = (this.investmentData.roiPercentage >= 0 ? '+' : '') + this.investmentData.roiPercentage.toFixed(1) + '%';
                roiElement.className = this.investmentData.roiPercentage >= 0 ? 'roi-positive' : 'roi-negative';
                
                document.getElementById('win-rate').textContent = this.investmentData.winRate.toFixed(1) + '%';
                document.getElementById('current-strategy').textContent = this.getStrategyName(this.investmentData.currentStrategy);
                
                // AI関連情報更新
                document.getElementById('ai-accuracy').textContent = this.investmentData.aiAccuracy.toFixed(1) + '%';
                document.getElementById('learning-samples').textContent = this.investmentData.learningSamples.toLocaleString();
                document.getElementById('ai-boost').textContent = '+' + this.investmentData.aiBoost.toFixed(1) + '%';
                document.getElementById('last-learning').textContent = new Date().toLocaleTimeString('ja-JP');
            }
            
            getStrategyName(strategy) {
                const names = {
                    'conservative': '保守的',
                    'balanced': 'バランス',
                    'aggressive': '積極的'
                };
                return names[strategy] || 'バランス';
            }
            
            refreshOpportunities() {
                // 投資機会を再取得
                this.showLoadingSpinner();
                
                // APIからデータ取得（模擬）
                setTimeout(() => {
                    this.hideLoadingSpinner();
                    this.updateOpportunities();
                }, 1000);
            }
            
            updateOpportunities() {
                console.log('AI投資機会を更新しました');
                // 実際の実装では、バックエンドのAI投資システムから最新データを取得
            }
            
            mockAnalyzeOpportunity(venueId, raceNumber) {
                // 模擬投資機会分析
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const confidence = 0.6 + Math.random() * 0.3;
                        const shouldInvest = confidence >= 0.65;
                        
                        resolve({
                            should_invest: shouldInvest,
                            venue_id: venueId,
                            race_number: raceNumber,
                            prediction_confidence: confidence,
                            recommended_boat: Math.floor(Math.random() * 6) + 1,
                            bet_type: 'win',
                            recommended_bet_amount: shouldInvest ? 100 + Math.random() * 400 : 0,
                            expected_odds: 1.5 + Math.random() * 4,
                            risk_assessment: shouldInvest ? 'AI投資条件クリア' : '信頼度不足',
                            ai_enhanced: true
                        });
                    }, 500);
                });
            }
            
            mockExecuteInvestment(analysis) {
                // 模擬投資実行
                return new Promise((resolve) => {
                    setTimeout(() => {
                        if (this.simulationMode) {
                            const won = Math.random() < analysis.prediction_confidence;
                            const payout = won ? analysis.recommended_bet_amount * analysis.expected_odds : 0;
                            const profit = payout - analysis.recommended_bet_amount;
                            
                            resolve({
                                executed: true,
                                simulation_mode: true,
                                won: won,
                                actual_payout: payout,
                                profit: profit,
                                bet_amount: analysis.recommended_bet_amount
                            });
                        } else {
                            resolve({
                                executed: false,
                                message: '実投資機能は安全のため無効化されています'
                            });
                        }
                    }, 300);
                });
            }
            
            mockRunSession() {
                // 模擬投資セッション実行
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const testRaces = [[4, 1], [4, 2], [12, 1]];
                        const investments = [];
                        let totalInvestment = 0;
                        let totalReturn = 0;
                        
                        testRaces.forEach((race, index) => {
                            const confidence = 0.6 + Math.random() * 0.3;
                            const betAmount = 100 + Math.random() * 200;
                            const won = Math.random() < confidence;
                            const payout = won ? betAmount * (1.5 + Math.random() * 3) : 0;
                            
                            totalInvestment += betAmount;
                            totalReturn += payout;
                            
                            investments.push({
                                venue_id: race[0],
                                race_number: race[1],
                                bet_amount: betAmount,
                                won: won,
                                actual_payout: payout,
                                confidence: confidence
                            });
                        });
                        
                        resolve({
                            investments_count: investments.length,
                            total_session_investment: totalInvestment,
                            total_session_return: totalReturn,
                            session_profit: totalReturn - totalInvestment,
                            investments_made: investments,
                            simulation_mode: this.simulationMode
                        });
                    }, 2000);
                });
            }
            
            async executeInvestment(venueId, raceNumber) {
                if (!confirm(`AI投資システムで会場${venueId} ${raceNumber}Rへの投資を実行しますか？`)) {
                    return;
                }
                
                try {
                    // 投資機会分析
                    const analysis = await this.investmentSystem.analyzeOpportunity(venueId, raceNumber);
                    
                    if (!analysis.should_invest) {
                        alert(`投資条件未達: ${analysis.risk_assessment}`);
                        return;
                    }
                    
                    // 投資実行
                    const result = await this.investmentSystem.executeInvestment(analysis);
                    
                    const mode = this.simulationMode ? 'シミュレーション' : '実投資';
                    console.log(`${mode}モードでAI投資実行: 会場${venueId} ${raceNumber}R`);
                    
                    if (result.executed) {
                        this.showInvestmentResult(venueId, raceNumber, result);
                        this.updateInvestmentHistory(venueId, raceNumber, result);
                    }
                } catch (error) {
                    alert(`投資実行エラー: ${error.message}`);
                }
            }
            
            async runInvestmentSession() {
                if (!confirm('AI投資セッションを実行しますか？複数レースを自動分析・投資します。')) {
                    return;
                }
                
                const sessionResults = document.getElementById('session-results');
                sessionResults.style.display = 'block';
                
                // ローディング表示
                document.getElementById('session-summary').innerHTML = `
                    <div class="col-12 text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">AI投資セッション実行中...</span>
                        </div>
                        <p class="mt-2">AI投資セッション実行中...</p>
                    </div>
                `;
                
                try {
                    const sessionResult = await this.investmentSystem.runSession();
                    
                    // セッション結果表示
                    document.getElementById('session-summary').innerHTML = `
                        <div class="col-md-3">
                            <div class="text-center">
                                <h5>投資実行数</h5>
                                <h3 class="text-primary">${sessionResult.investments_count}件</h3>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h5>総投資額</h5>
                                <h3 class="text-info">¥${Math.round(sessionResult.total_session_investment).toLocaleString()}</h3>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h5>総回収額</h5>
                                <h3 class="text-success">¥${Math.round(sessionResult.total_session_return).toLocaleString()}</h3>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h5>純利益</h5>
                                <h3 class="${sessionResult.session_profit >= 0 ? 'text-success' : 'text-danger'}">
                                    ¥${sessionResult.session_profit >= 0 ? '+' : ''}${Math.round(sessionResult.session_profit).toLocaleString()}
                                </h3>
                            </div>
                        </div>
                    `;
                    
                    // 詳細結果表示
                    let detailsHtml = '<h6>投資詳細:</h6>';
                    sessionResult.investments_made.forEach((investment, index) => {
                        const profit = investment.actual_payout - investment.bet_amount;
                        detailsHtml += `
                            <div class="alert ${investment.won ? 'alert-success' : 'alert-danger'} d-flex justify-content-between">
                                <div>
                                    <strong>会場${investment.venue_id} ${investment.race_number}R</strong> - 
                                    投資額: ¥${Math.round(investment.bet_amount).toLocaleString()} | 
                                    信頼度: ${Math.round(investment.confidence * 100)}%
                                </div>
                                <div>
                                    ${investment.won ? '的中' : '外れ'}: 
                                    <strong class="${profit >= 0 ? 'text-success' : 'text-danger'}">
                                        ¥${profit >= 0 ? '+' : ''}${Math.round(profit).toLocaleString()}
                                    </strong>
                                </div>
                            </div>
                        `;
                    });
                    
                    document.getElementById('session-details').innerHTML = detailsHtml;
                    
                    // 統計更新
                    this.investmentData.availableFunds += sessionResult.session_profit;
                    this.updateDashboard();
                    
                } catch (error) {
                    document.getElementById('session-summary').innerHTML = `
                        <div class="col-12">
                            <div class="alert alert-danger">
                                セッション実行エラー: ${error.message}
                            </div>
                        </div>
                    `;
                }
            }
            
            showInvestmentResult(venueId, raceNumber, result) {
                const resultText = result.won ? '的中' : '外れ';
                const profit = Math.round(result.profit);
                const alertClass = result.won ? 'alert-success' : 'alert-danger';
                
                const alertHtml = `
                    <div class="alert ${alertClass} alert-dismissible fade show">
                        <strong>AI投資結果</strong> 会場${venueId} ${raceNumber}R: ${resultText} 
                        (投資額: ¥${Math.round(result.bet_amount).toLocaleString()}, 
                        収益: ¥${profit >= 0 ? '+' : ''}${profit.toLocaleString()})
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                `;
                
                document.querySelector('.container').insertAdjacentHTML('afterbegin', alertHtml);
            }
            
            updateInvestmentHistory(venueId, raceNumber, result) {
                // 投資履歴テーブル更新（模擬）
                const tbody = document.querySelector('#investment-history-table tbody');
                const newRow = document.createElement('tr');
                const now = new Date();
                const timeStr = now.toLocaleTimeString('ja-JP');
                const profit = Math.round(result.profit);
                
                newRow.innerHTML = `
                    <td>${timeStr}</td>
                    <td>会場${venueId} ${raceNumber}R</td>
                    <td>AI投資</td>
                    <td>¥${Math.round(result.bet_amount).toLocaleString()}</td>
                    <td><span class="badge ${result.won ? 'bg-success' : 'bg-danger'}">${result.won ? '的中' : '外れ'}</span></td>
                    <td class="${profit >= 0 ? 'roi-positive' : 'roi-negative'}">¥${profit >= 0 ? '+' : ''}${profit.toLocaleString()}</td>
                `;
                
                tbody.insertBefore(newRow, tbody.firstChild);
                
                // 10行を超える場合は古い行を削除
                while (tbody.children.length > 10) {
                    tbody.removeChild(tbody.lastChild);
                }
                
                // 統計更新
                this.investmentData.availableFunds += result.profit;
                this.updateDashboard();
            }
            
            changeStrategy(strategy) {
                this.investmentData.currentStrategy = strategy;
                this.updateDashboard();
                
                console.log(`AI投資戦略を${this.getStrategyName(strategy)}に変更しました`);
            }
            
            startAutoInvestment() {
                console.log('AI自動投資を開始しました');
                // AI自動投資ロジック（実装時は適切な間隔で実行）
            }
            
            stopAutoInvestment() {
                console.log('AI自動投資を停止しました');
            }
            
            startLiveUpdates() {
                // 30秒毎にデータ更新
                setInterval(() => {
                    this.refreshOpportunities();
                    // AI学習データも更新
                    this.investmentData.learningSamples += Math.floor(Math.random() * 3);
                    this.updateDashboard();
                }, 30000);
            }
            
            showLoadingSpinner() {
                // ローディングスピナー表示
            }
            
            hideLoadingSpinner() {
                // ローディングスピナー非表示
            }
        }
        
        // グローバル関数
        function refreshOpportunities() {
            dashboard.refreshOpportunities();
        }
        
        function executeInvestment(venueId, raceNumber) {
            dashboard.executeInvestment(venueId, raceNumber);
        }
        
        function runInvestmentSession() {
            dashboard.runInvestmentSession();
        }
        
        // 初期化
        const dashboard = new AIInvestmentDashboard();
        
        // リアルタイム時計
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ja-JP');
            document.title = `AI投資管理 [${timeString}] | 競艇AI予想システム`;
        }
        
        setInterval(updateClock, 1000);
    </script>
</body>
</html>