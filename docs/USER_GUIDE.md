# 競輪予想システム - ユーザーガイド

## 📋 目次
1. [はじめに](#はじめに)
2. [インストール・セットアップ](#インストールセットアップ)
3. [基本的な使い方](#基本的な使い方)
4. [機能別詳細ガイド](#機能別詳細ガイド)
5. [コマンドライン版](#コマンドライン版)
6. [設定のカスタマイズ](#設定のカスタマイズ)
7. [トラブルシューティング](#トラブルシューティング)
8. [よくある質問](#よくある質問)

---

## はじめに

競輪予想システムへようこそ！このシステムは、競輪レースの結果を高精度で予想するAIシステムです。

### 🎯 システムの特徴
- **高精度予想**: 82.5%の信頼度を実現
- **リアルタイム**: 最新のレース情報を即座に取得
- **使いやすさ**: 直感的なメニュー操作
- **多機能**: レース検索から買い目推奨まで

### 🚀 主な機能
- 本日・明日のレース一覧表示
- 開催場別レース検索
- 詳細予想とスコア表示
- 買い目推奨機能
- キャッシュ管理とシステム設定

---

## インストール・セットアップ

### 必要環境
- **Python**: 3.8以上
- **OS**: Windows, macOS, Linux
- **メモリ**: 最低512MB
- **ストレージ**: 100MB以上の空き容量

### インストール手順

1. **リポジトリのクローン**
```bash
git clone <repository-url>
cd keirin
```

2. **依存関係のインストール**
```bash
pip install -r requirements.txt
```

3. **システムの起動確認**
```bash
python main.py
```

4. **初回セットアップ**
初回起動時に自動でキャッシュディレクトリとログファイルが作成されます。

---

## 基本的な使い方

### 🚀 システム起動

```bash
python main.py
```

起動すると、以下のようなメインメニューが表示されます：

```
🚴 競輪予想システム v1.0.0
競輪予想システムへようこそ

┌────────────────────────────────────────────────────────────┐
│  🗓️  2025年08月05日 13:45  |  📊 キャッシュ稼働中  |  🔄 データ自動更新    │
└────────────────────────────────────────────────────────────┘

┌─ 🚴 競輪予想システム - メインメニュー ─┐
│  1.  📅 本日のレース一覧        今日開催中のレースを表示      │
│  2.  📈 明日のレース一覧        明日開催予定のレースを表示    │
│  3.  🔍 開催場検索             特定の競輪場からレースを検索   │
│  4.  📊 予想履歴               過去の予想結果を確認          │
│  5.  ⚙️  設定・管理            アプリケーション設定とキャッシュ管理 │
│  6.  ❓ ヘルプ                使い方とコマンド一覧          │
│  7.  ❌ 終了                  アプリケーションを終了        │
└────────────────────────────────────────────────────────────┘

選択してください (1-7) [1]:
```

### 📅 基本操作フロー

1. **メニュー選択** → 数字キーで機能を選択
2. **レース一覧確認** → 開催中のレースを確認
3. **レース選択** → 予想したいレースを番号で指定
4. **予想実行** → システムが自動で分析・予想
5. **結果確認** → 順位予想と買い目推奨を表示

---

## 機能別詳細ガイド

### 📅 本日のレース一覧 (メニュー1)

本日開催中のレース一覧を表示します。

**表示内容:**
- **開催場**: 競輪場名
- **R**: レース番号
- **発走時刻**: レース開始時間
- **グレード**: GP, G1, G2, G3, F1, F2
- **賞金**: 優勝賞金額
- **状態**: 発売中/終了

**操作方法:**
1. メニューで「1」を選択
2. レース一覧が表示されるまで待機
3. 予想したいレース番号を入力
4. 「y」で予想実行を確認

**表示例:**
```
📋 本日のレース一覧
┌────┬────────┬───┬──────────┬────────┬────────┬────────┐
│ No.│ 開催場   │ R │ 発走時刻   │ グレード │ 賞金    │ 状態    │
├────┼────────┼───┼──────────┼────────┼────────┼────────┤
│ 1  │ 平塚    │ 1 │ 10:15    │ F1      │ 100万   │ 発売中  │
│ 2  │ 平塚    │ 2 │ 10:45    │ F1      │ 100万   │ 発売中  │
│ 3  │ 川崎    │ 1 │ 11:00    │ F2      │ 80万    │ 発売中  │
└────┴────────┴───┴──────────┴────────┴────────┴────────┘
```

### 📈 明日のレース一覧 (メニュー2)

明日開催予定のレース一覧を表示します。操作方法は本日のレースと同様です。

### 🔍 開催場検索 (メニュー3)

特定の競輪場のレースを検索します。

**操作手順:**
1. メニューで「3」を選択
2. 競輪場一覧から番号を選択
3. 該当する開催場のレースが表示

**競輪場一覧例:**
```
🏟️ 競輪場一覧
┌────┬────────┬────────┬────────┬───────────────┐
│ No.│ 競輪場   │ 距離    │ バンク  │ 特徴           │
├────┼────────┼────────┼────────┼───────────────┤
│ 1  │ 函館    │ 400m    │ 31.5°  │ 標準バンク      │
│ 2  │ 青森    │ 400m    │ 31.5°  │ 標準バンク      │
│ 3  │ いわき平 │ 400m    │ 31.5°  │ 標準バンク      │
└────┴────────┴────────┴────────┴───────────────┘
```

### 🔮 予想実行

レースを選択すると、以下の流れで予想が実行されます：

1. **データ取得**: レース詳細情報を自動取得
2. **分析処理**: 選手能力・近況・相性を総合分析
3. **スコア計算**: 各選手の総合スコアを算出
4. **順位決定**: スコアに基づいて順位を決定
5. **信頼度計算**: 予想の信頼度を算出

**予想結果表示例:**
```
🏟️ 平塚 1R  🕐 10:15  🏆 F1  💰 100万円

🔮 予想結果
┌────┬────────┬────┬────┬────┬────────┬────────┬────┐
│車番│ 選手名   │年齢│級班│勝率│ 連対率  │ 予想順位│推奨度│
├────┼────────┼────┼────┼────┼────────┼────────┼────┤
│ 1  │ 田中太郎 │ 28 │ A1 │0.25│ 0.45   │1位 ★★★★★│ S  │
│ 4  │ 佐藤次郎 │ 32 │ A2 │0.22│ 0.42   │2位 ★★★★ │ A  │
│ 7  │ 鈴木三郎 │ 26 │ A1 │ 0.20│ 0.40   │3位 ★★★  │ B  │
└────┴────────┴────┴────┴────┴────────┴────────┴────┘

💡 おすすめ買い目
┌────────┬───────┬──────────┬────────┬────────┐
│ 券種    │ 買い目  │ 予想オッズ │ 信頼度  │ 期待値  │
├────────┼───────┼──────────┼────────┼────────┤
│ 3連単   │ 1-4-7  │ 12.5倍    │ S      │ +15.2% │
│ 3連複   │ 1-4-7  │ 8.2倍     │ A      │ +8.9%  │
│ ワイド  │ 1-4    │ 3.1倍     │ A      │ +5.3%  │
└────────┴───────┴──────────┴────────┴────────┘

┌─ 信頼度 ─┐
│ 予想信頼度: 82.5% │
└──────────────┘
```

### ⚙️ 設定・管理 (メニュー5)

システムの設定確認とキャッシュ管理を行います。

**設定メニュー:**
```
⚙️  設定・管理メニュー
┌───┬─────────────────┬──────────────────────────┐
│ 1.│ 📊 キャッシュ情報表示  │ 現在のキャッシュ状況を確認        │
│ 2.│ 🗑️  キャッシュクリア   │ 全キャッシュデータを削除         │
│ 3.│ 🧹 期限切れキャッシュ削除│ 期限切れデータのみ削除          │
│ 4.│ ⚙️  システム設定表示   │ 現在の設定値を表示              │
│ 5.│ 🔄 データソース状態   │ データ取得先の状態確認          │
│ 6.│ ✏️  設定変更           │ アプリケーション設定を編集      │
│ 0.│ ⬅️  メインメニューに戻る│                               │
└───┴─────────────────┴──────────────────────────┘
```

**キャッシュ情報例:**
```
📊 キャッシュ情報
┌─────────────────────────────┐
│ 📊 総エントリ数: 245           │
│ ✅ 有効エントリ数: 198         │
│ ⏰ 期限切れエントリ数: 47      │
│                               │
│ 💾 キャッシュファイル: cache/cache.db │
└─────────────────────────────┘
```

---

## コマンドライン版

GUI版以外に、コマンドライン直接実行も可能です。

### 基本コマンド

```bash
# システム起動（GUI版）
python main.py

# サンプル予想テスト
python main.py test

# 特定レースの予想
python main.py predict 20241205_平塚_01

# キャッシュ情報表示
python main.py cache-info

# キャッシュクリア
python main.py clear-cache

# バージョン表示
python main.py --version
```

### コマンドオプション

| オプション | 説明 | 例 |
|-----------|------|-----|
| `test` | サンプルデータで予想テスト | `python main.py test` |
| `predict <race_id>` | 指定レースの予想実行 | `python main.py predict 20241205_平塚_01` |
| `cache-info` | キャッシュ統計表示 | `python main.py cache-info` |
| `clear-cache` | 全キャッシュクリア | `python main.py clear-cache` |
| `--version` | バージョン情報表示 | `python main.py --version` |

---

## 設定のカスタマイズ

アプリケーションの設定は、CLIの「設定・管理」メニューから「設定変更」を選択することで、対話的に変更し永続化することができます。これにより、`config/settings.py` ファイルを直接編集することなく、アプリケーションの動作を調整できます。

### ✏️ 設定変更メニュー

「設定・管理」メニューから「6. 設定変更」を選択すると、以下のサブメニューが表示されます。

```
✏️ 設定編集
┌───┬───────────────────────┬──────────────────────────┐
│ 1.│ 📝 ログ設定             │ ログ出力に関する設定            │
│ 2.│ 🌐 スクレイピング設定   │ データ取得に関する設定          │
│ 3.│ ⏱️ キャッシュ期間設定   │ キャッシュの有効期間設定        │
│ 4.│ 🎯 予想アルゴリズム重み │ 予想ロジックの重み設定          │
│ 5.│ 🖥️ 表示設定             │ CLIの表示に関する設定           │
│ 6.│ 📊 パフォーマンス監視設定│ システムパフォーマンス監視に関する設定│
│ 0.│ ⬅️  設定・管理メニューに戻る│                          │
└───┴───────────────────────┴──────────────────────────┘
```

各項目を選択することで、対応する設定値を変更できます。

#### 📝 ログ設定

- **ログレベル**: `DEBUG`, `INFO`, `WARNING`, `ERROR`, `CRITICAL` から選択。
- **デバッグモード**: `True` または `False` で有効/無効を切り替え。

#### 🌐 スクレイピング設定

- **レート制限**: データ取得間の待機時間（秒）。
- **タイムアウト**: データ取得の最大待機時間（秒）。
- **最大リトライ**: データ取得失敗時の最大リトライ回数。

#### ⏱️ キャッシュ期間設定

- `race_info`, `rider_stats`, `odds`, `venue_data` など、各データカテゴリのキャッシュ有効期間（分）を設定。

#### 🎯 予想アルゴリズム重み

- `rider_ability`, `recent_form`, `track_compatibility`, `line_strategy`, `external_factors` の重み（0.0〜1.0の浮動小数点数）を設定。
- **注意**: 重みの合計が1.0になるように調整してください。

#### 🖥️ 表示設定

- **最大レース表示数**: レース一覧に表示する最大件数。
- **スター評価**: 予想結果にスター評価を表示するかどうか（True/False）。
- **色分け表示**: CLIの表示に色分けを適用するかどうか（True/False）。

#### 📊 パフォーマンス監視設定

- **監視間隔**: システムメトリクスを収集する間隔（秒）。
- **CPU警告閾値/危険閾値**: CPU使用率がこの値を超えると警告/危険と判断される閾値（%）。
- **メモリ警告閾値/危険閾値**: メモリ使用量（MB）がこの値を超えると警告/危険と判断される閾値。
- **キャッシュヒット率警告閾値/危険閾値**: キャッシュヒット率がこの値を下回ると警告/危険と判断される閾値（0.0〜1.0）。

変更した設定は自動的に保存され、次回アプリケーション起動時にも適用されます。

---

## トラブルシューティング

### よくある問題と解決方法

#### 🔴 データ取得エラー

**症状**: レース一覧が表示されない
```
[red]レース情報の取得に失敗しました。[/red]
```

**解決方法:**
1. インターネット接続を確認
2. ファイアウォール設定を確認
3. キャッシュをクリアして再実行
4. しばらく時間をおいて再実行

#### 🔴 予想実行エラー

**症状**: 予想計算中にエラーが発生
```
[red]予想実行エラー: list index out of range[/red]
```

**解決方法:**
1. レース詳細の再取得を試行
2. 別のレースで動作確認
3. キャッシュクリア後に再実行
4. ログファイル（`logs/keirin.log`）でエラー詳細を確認

#### 🔴 起動エラー

**症状**: システムが起動しない

**解決方法:**
1. Python バージョン確認（3.8以上必要）
```bash
python --version
```

2. 依存関係の再インストール
```bash
pip install -r requirements.txt --force-reinstall
```

3. 権限の確認（ディレクトリの読み書き権限）

#### 🔴 キャッシュ関連エラー

**症状**: キャッシュファイルにアクセスできない

**解決方法:**
1. `cache` ディレクトリの作成
```bash
mkdir cache
```

2. 書き込み権限の確認
3. 全キャッシュクリア
```bash
python main.py clear-cache
```

### ログファイルの確認

詳細なエラー情報は以下のログファイルで確認できます：

- `logs/keirin.log`: 一般的なシステムログ
- `logs/keirin_error.log`: エラーレベル以上のログ
- `logs/performance_metrics.json`: パフォーマンスメトリクスデータ

**ログ例:**
```
2025-08-05 13:04:44,532 - prediction.predictor - INFO - 予想開始: 20241205_15_01
2025-08-05 13:04:44,534 - prediction.predictor - INFO - 予想完了: 1位予想 7番
2025-08-05 13:12:42,474 - prediction.predictor - ERROR - 予想実行エラー: list index out of range
```

---

## よくある質問

### Q1: 予想の精度はどの程度ですか？

A: 現在のシステムでは平均82.5%の信頼度を実現しています。ただし、競輪は不確定要素も多いため、参考程度にご利用ください。

### Q2: データはリアルタイムで更新されますか？

A: キャッシュシステムにより、データは自動で更新されます。レース情報は30分間、レース詳細は1時間キャッシュされます。

### Q3: 予想アルゴリズムは変更できますか？

A: CLIの「設定・管理」メニューから「設定変更」を選択し、「予想アルゴリズム重み」を編集することで、予想の傾向を調整できます。

### Q4: どの競輪場に対応していますか？

A: 全国の主要競輪場に対応しています。データ取得できない場合は、サンプルデータで動作確認できます。

### Q5: システムが重いのですが？

A: 以下の対処法をお試しください：
- 期限切れキャッシュの削除
- 表示レース数の制限
- 不要なログファイルの削除
- CLIの「設定・管理」メニューから「設定変更」を選択し、「パフォーマンス監視設定」の閾値を調整する。

### Q6: エラーが頻発します

A: 以下を確認してください：
- インターネット接続状況
- Python・ライブラリのバージョン
- ディスク容量とメモリ使用量
- ログファイルでエラー詳細を確認

### Q7: 予想結果を保存できますか？

A: 現在は画面表示のみですが、将来のバージョンで履歴保存機能を追加予定です。

### Q8: モバイルで使用できますか？

A: 現在はPC向けのCLI版のみです。将来的にWeb版・モバイルアプリも開発予定です。

---

## サポート・お問い合わせ

### 技術サポート
- **ログ確認**: `logs/keirin.log`, `logs/keirin_error.log`, `logs/performance_metrics.json`
- **設定確認**: CLI設定メニュー
- **キャッシュ管理**: CLI設定メニュー

### 開発情報
- **バージョン**: v1.0.0
- **最終更新**: 2025年8月5日
- **開発者**: Claude Code Assistant

### フィードバック
システムに関するご意見・ご要望は、GitHubのIssuesでお知らせください。

---

🚴 **競輪予想システムをお楽しみください！** 🚴

*最終更新: 2025年8月5日*
*バージョン: v1.0.0*